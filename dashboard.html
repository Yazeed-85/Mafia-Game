<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</title>
    <style>
        body { font-family: sans-serif; background-color: #111; color: white; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: #1a1a1a; padding: 30px; border-radius: 15px; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.5);}
        h1 { color: #dc2626; text-align: center; border-bottom: 2px solid #333; padding-bottom: 15px; margin-top: 0;}
        
        .stats-box { background: #222; padding: 20px; text-align: center; border-radius: 10px; margin-bottom: 20px; border: 1px solid #444;}
        .total-number { font-size: 3.5rem; font-weight: bold; color: #f59e0b; margin-top: 10px;}
        
        /* Ø£Ø¯ÙˆØ§Øª Ø§Ù„ÙØ±Ø² */
        .controls { display: flex; justify-content: space-between; align-items: center; background: #222; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #333;}
        select { padding: 10px; border-radius: 8px; background: #333; color: white; border: 1px solid #555; font-size: 1rem; outline: none; cursor: pointer;}
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ø¸ÙŠÙ */
        table { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 10px; background: #222; border-radius: 10px; overflow: hidden; border: 1px solid #333;}
        th, td { padding: 18px 15px; text-align: right; border-bottom: 1px solid #333; }
        th { background-color: #dc2626; color: white; font-weight: bold; font-size: 1.1rem; text-transform: uppercase;}
        tr:last-child td { border-bottom: none; }
        tr:hover { background-color: #2a2a2a; }
        td { color: #ddd; font-size: 1.05rem;}
        .player-name { font-weight: bold; color: #fff; }
        .room-badge { background: #4b5563; padding: 5px 12px; border-radius: 20px; font-weight: bold;}
    </style>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB5CobIKfYdAz8jaabJpMQrGoqS9Ton28Y",
            authDomain: "buttons-f3501.firebaseapp.com",
            databaseURL: "https://buttons-f3501-default-rtdb.firebaseio.com",
            projectId: "buttons-f3501"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const logsRef = ref(db, `mafia_logs/players`);
        
        let allLogs = [];

        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        onValue(logsRef, (snapshot) => {
            allLogs = [];
            if (snapshot.exists()) {
                const data = snapshot.val();
                Object.keys(data).forEach(key => {
                    allLogs.push({
                        id: key,
                        name: data[key].name,
                        room: data[key].room,
                        time: data[key].time,
                        timestamp: data[key].timestamp || 0
                    });
                });
            }
            document.getElementById('totalCount').innerText = allLogs.length;
            renderTable();
        });

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø²
        window.renderTable = function() {
            const sortType = document.getElementById('sortSelect').value;
            let sortedLogs = [...allLogs];

            if (sortType === 'newest') {
                sortedLogs.sort((a, b) => b.timestamp - a.timestamp);
            } else if (sortType === 'oldest') {
                sortedLogs.sort((a, b) => a.timestamp - b.timestamp);
            } else if (sortType === 'name') {
                sortedLogs.sort((a, b) => a.name.localeCompare(b.name, 'ar'));
            } else if (sortType === 'room') {
                sortedLogs.sort((a, b) => b.room.localeCompare(a.room));
            }

            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';

            if (sortedLogs.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding: 30px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</td></tr>';
                return;
            }

            sortedLogs.forEach((player, index) => {
                const row = `<tr>
                    <td style="color: #888;">${index + 1}</td>
                    <td class="player-name">${player.name}</td>
                    <td><span class="room-badge">${player.room}</span></td>
                    <td style="color: #aaa; font-size: 0.95rem;">${player.time}</td>
                </tr>`;
                tableBody.innerHTML += row;
            });
        };
    </script>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø§ÙÙŠØ§</h1>
        
        <div class="stats-box">
            <div style="color: #aaa;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ Ø§Ù„Ø°ÙŠÙ† Ø¯Ø®Ù„ÙˆØ§ Ø§Ù„Ù„Ø¹Ø¨Ø©</div>
            <div class="total-number" id="totalCount">0</div>
        </div>

        <div class="controls">
            <div style="font-weight: bold; color: #ccc;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª:</div>
            <div>
                <label style="color: #888; margin-left: 10px;">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨:</label>
                <select id="sortSelect" onchange="renderTable()">
                    <option value="newest">Ø§Ù„Ø£Ø­Ø¯Ø« Ø¯Ø®ÙŠÙˆÙ„Ø§Ù‹ (Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ)</option>
                    <option value="oldest">Ø§Ù„Ø£Ù‚Ø¯Ù… Ø¯Ø®ÙˆÙ„Ø§Ù‹</option>
                    <option value="name">Ø§Ù„Ø§Ø³Ù… (Ø£ - ÙŠ)</option>
                    <option value="room">Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©</option>
                </select>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th style="width: 5%; border-top-right-radius: 10px;">#</th>
                    <th>Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ / Ø§Ù„Ø¯ÙˆØ±</th>
                    <th>Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©</th>
                    <th style="border-top-left-radius: 10px;">ÙˆÙ‚Øª ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø¨Ø§Ù„ÙŠÙˆÙ…)</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
        </table>
    </div>
</body>
</html>
